<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ProfileWriterBuilder.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jillion</a> &gt; <a href="index.source.html" class="el_package">org.jcvi.jillion.profile</a> &gt; <span class="el_source">ProfileWriterBuilder.java</span></div><h1>ProfileWriterBuilder.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Jillion development code
 * 
 * This code may be freely distributed and modified under the
 * terms of the GNU Lesser General Public License.  This should
 * be distributed with the code.  If you do not have a copy,
 *  see:
 * 
 *          http://www.gnu.org/copyleft/lesser.html
 * 
 * 
 * Copyright for this code is held jointly by the individual authors.  These should be listed in the @author doc comments.
 * 
 * Information about Jillion can be found on its homepage
 * 
 *         http://jillion.sourceforge.net
 * 
 * Contributors:
 *     Danny Katzel - initial API and implementation
 ******************************************************************************/
package org.jcvi.jillion.profile;

import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.util.Objects;

import org.jcvi.jillion.core.residue.nt.NucleotideSequence;
/**
 * {@code ProfileWriterBuilder}
 * is a builder object that is used to configure
 * and create a {@link ProfileWriter}.
 * @author dkatzel
 *
 */
public class ProfileWriterBuilder {

	private final File outputFile;
	private final OutputStream outStream;
	
<span class="fc" id="L41">	private DisplayCountStrategy displayPercentages =DisplayCountStrategy.COUNTS;</span>
	private final NucleotideSequence referenceOrConsensus;
	
<span class="fc" id="L44">	private MostFrequentTieBreakerRule tieBreakerRule = MostFrequentTieBreakerRule.LOWEST_ASCII;</span>
	
<span class="fc" id="L46">	private boolean include0xEdges=true;</span>
<span class="fc" id="L47">	private boolean ignoreGappedConsensusPositions = false;</span>
	/**
	 * Create a new ProfileWriterBuilder that will use
	 * the given reference or consensus sequence as the profile
	 * reference (and length as the profile length) and write the
	 * resulting profile to the provided file.
	 * @param outputFile the output file to write the profile to;
	 * can not be null.
	 * @param referenceOrConsensus the reference sequence to use.
	 * the sequence's length is also used to determine the profile length.
	 * @throws NullPointerException if either parameter is null.
	 * @throws IllegalArgumentException if the reference length is &gt; {@link Integer#MAX_VALUE}.
	 */
<span class="fc" id="L60">	public ProfileWriterBuilder(File outputFile, NucleotideSequence referenceOrConsensus) {</span>
<span class="fc" id="L61">		Objects.requireNonNull(outputFile);</span>
<span class="fc" id="L62">		Objects.requireNonNull(referenceOrConsensus);</span>
		
<span class="fc" id="L64">		verifySequenceLength(referenceOrConsensus);</span>
		
<span class="fc" id="L66">		this.outputFile = outputFile;</span>
<span class="fc" id="L67">		this.outStream = null;</span>
<span class="fc" id="L68">		this.referenceOrConsensus = referenceOrConsensus;</span>
<span class="fc" id="L69">	}</span>
	/**
	 * Create a new ProfileWriterBuilder that will use
	 * the given reference or consensus sequence as the profile
	 * reference (and length as the profile length) and write the
	 * resulting profile to the provided {@link OutputStream}.
	 * @param out the {@link OutputStream} to write the profile to;
	 * can not be null.
	 * @param referenceOrConsensus the reference sequence to use.
	 * the sequence's length is also used to determine the profile length.
	 * @throws NullPointerException if either parameter is null.
	 * @throws IllegalArgumentException if the reference length is &gt; {@link Integer#MAX_VALUE}.
	 */
<span class="fc" id="L82">	public ProfileWriterBuilder(OutputStream out, NucleotideSequence referenceOrConsensus) {</span>
		
<span class="fc" id="L84">		Objects.requireNonNull(out);</span>
<span class="fc" id="L85">		Objects.requireNonNull(referenceOrConsensus);</span>
<span class="fc" id="L86">		verifySequenceLength(referenceOrConsensus);</span>
<span class="fc" id="L87">		this.outputFile = null;</span>
<span class="fc" id="L88">		this.outStream = out;</span>
<span class="fc" id="L89">		this.referenceOrConsensus = referenceOrConsensus;</span>
<span class="fc" id="L90">	}</span>
	
	private void verifySequenceLength(NucleotideSequence seq){
<span class="fc bfc" id="L93" title="All 2 branches covered.">		if(seq.getLength() &gt;Integer.MAX_VALUE){</span>
<span class="fc" id="L94">			throw new IllegalArgumentException(</span>
<span class="fc" id="L95">					String.format(&quot;reference sequence too long, max length is 2^31-1 but this is %d&quot;, seq.getLength()));</span>
		}
<span class="fc" id="L97">	}</span>

	/**
	 * Sets the {@link MostFrequentTieBreakerRule} instance to use
	 * to govern the &quot;most frequent&quot; column of the profile. If this
	 * method is not called, then by default {@link MostFrequentTieBreakerRule#LOWEST_ASCII}
	 * is used.
	 * @param tieBreakerRule the {@link MostFrequentTieBreakerRule} instance to use;
	 * can not be null.
	 * @return this.
	 * @throws NullPointerException if tieBreakerRule is null.
	 */
	public ProfileWriterBuilder setMostFrequentTieBreakerRule(MostFrequentTieBreakerRule tieBreakerRule){
<span class="fc" id="L110">		Objects.requireNonNull(tieBreakerRule);</span>
<span class="fc" id="L111">		this.tieBreakerRule = tieBreakerRule;</span>
<span class="fc" id="L112">		return this;</span>
	}
	/**
	 * Should 0x regions at the edge of the profile be included in the output.
	 * If not called, by default this value is set to {@code true}.
	 * When comparing several profiles against the same reference
	 * it is important to include the edges even if 0x
	 * in order to more easily compare them.
	 * @param include0xEdges {@code true} if should be included;
	 * {@code false} otherwise.
	 * @return this.
	 */
	public ProfileWriterBuilder include0xEdges(boolean include0xEdges){
<span class="fc" id="L125">		this.include0xEdges = include0xEdges;</span>
<span class="fc" id="L126">		return this;</span>
	}
	/**
	 * Set the {@link DisplayCountStrategy} to use in the profile.
	 * If this method is not called, then by default {@link DisplayCountStrategy#COUNTS}
	 * is used.
	 * @param displayPercentages the {@link DisplayCountStrategy} to use; can not be null.
	 * @return this.
	 * @throws NullPointerException if parameter is null.
	 */
	public ProfileWriterBuilder displayPercentages(DisplayCountStrategy displayPercentages){
<span class="fc" id="L137">		this.displayPercentages = displayPercentages;</span>
<span class="fc" id="L138">		return this;</span>
	}
	/**
	 * Use the given configuration data provided so far
	 * to create a {@link ProfileWriter}.
	 * @return a new {@link ProfileWriter}.
	 * @throws IOException if the output file option is used
	 * and the file is unable to be created.
	 */
	public ProfileWriter build() throws IOException{
<span class="fc bfc" id="L148" title="All 2 branches covered.">		if(outputFile ==null){</span>
			//use stream
<span class="fc" id="L150">			return new SimpleProfileWriter(outStream, displayPercentages, tieBreakerRule, referenceOrConsensus, include0xEdges, ignoreGappedConsensusPositions);</span>
		}
<span class="fc" id="L152">		return new SimpleProfileWriter(outputFile, displayPercentages, tieBreakerRule, referenceOrConsensus, include0xEdges, ignoreGappedConsensusPositions);</span>
	}
	
	public ProfileWriterBuilder ignoreGappedConsensusPositions(boolean ignoreGappedConsensusPositions) {
<span class="fc" id="L156">		this.ignoreGappedConsensusPositions = ignoreGappedConsensusPositions;</span>
<span class="fc" id="L157">		return this;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>