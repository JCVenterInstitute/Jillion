<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SamRecordFlags.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jillion</a> &gt; <a href="index.source.html" class="el_package">org.jcvi.jillion.sam</a> &gt; <span class="el_source">SamRecordFlags.java</span></div><h1>SamRecordFlags.java</h1><pre class="source lang-java linenums">package org.jcvi.jillion.sam;

import java.util.BitSet;
import java.util.Collection;
import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;

import org.jcvi.jillion.core.io.IOUtil;
/**
 * Immutable Wrapper around bit flags set in a SAM/BAM file to show which
 * {@link SamRecordFlag} values are present in this SamRecord.
 * This class uses the flyweight pattern to save memory
 * since most of the millions of reads in BAM file will have the same
 * flag combinations.
 * 
 * Several mutator methods in this class such as {@link #add(SamRecordFlag)} and {@link #remove(SamRecordFlag)}
 * return new/different instances since these objects are immutable.
 * 
 * @author dkatzel
 *
 * @since 5.3
 */
public class SamRecordFlags {

<span class="fc" id="L25">    private static final ConcurrentHashMap&lt;Integer, SamRecordFlags&gt; CACHE = new ConcurrentHashMap&lt;&gt;();</span>
    /**
     * Get the {@link SamRecordFlags} object for the given set bits as an int (as it is stored in BAM).
     * @param bits the bit values for the set flag; will always be &gt;=0.
     * 
     * @return a {@link SamRecordFlags} object which may be the same reference as
     *         previously returned objects. Will never be null.
     */
    public static SamRecordFlags valueOf(int bits){
<span class="fc" id="L34">        return CACHE.computeIfAbsent(bits, i -&gt; new SamRecordFlags(i));</span>
    }
    /**
     * Get the {@link SamRecordFlags} object for the given set bits stored in a BitSet.
     * @param bits the bit values for the set flag; can not be null.
     * 
     * @return a {@link SamRecordFlags} object which may be the same reference as
     *         previously returned objects. Will never be null.
     *         
     * @throws NullPointerException if bits is null.
     */
    public static SamRecordFlags valueOf(BitSet bits){
<span class="nc" id="L46">        return valueOf((int)bits.toLongArray()[0]);</span>
    }
    /**
     * Get the {@link SamRecordFlags} object for the given collection of SamRecordFlag objects.
     * @param flags the {@link SamRecordFlag} objects to turn into a SamRecordFlags object.
     * 
     * @return a {@link SamRecordFlags} object which may be the same reference as
     *         previously returned objects. Will never be null.
     *         
     * @throws NullPointerException if the collection  is null or any value inside the collection is null.
     */
    public static SamRecordFlags valueOf(Collection&lt;SamRecordFlag&gt; flags){
<span class="fc" id="L58">        int v =0;</span>
<span class="fc bfc" id="L59" title="All 2 branches covered.">        for(SamRecordFlag f : flags){</span>
<span class="fc" id="L60">            v |=f.getBitFlags();</span>
<span class="fc" id="L61">        }</span>
<span class="fc" id="L62">        return valueOf(v);</span>
    }
    /**
     * Get the {@link SamRecordFlags} object for the given array/varargs of SamRecordFlag objects.
     * @param flags the {@link SamRecordFlag} objects to turn into a SamRecordFlags object.
     * 
     * @return a {@link SamRecordFlags} object which may be the same reference as
     *         previously returned objects. Will never be null.
     *         
     * @throws NullPointerException if any value inside the collection is null.
     */
    public static SamRecordFlags valueOf(SamRecordFlag... flags){
<span class="nc" id="L74">        int v =0;</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">        for(SamRecordFlag f : flags){</span>
<span class="nc" id="L76">            v |=f.getBitFlags();</span>
        }
<span class="nc" id="L78">        return valueOf(v);</span>
    }
    
    private int setBits;
    
<span class="fc" id="L83">    private SamRecordFlags(int setBits){</span>
<span class="fc" id="L84">        this.setBits = setBits;</span>
<span class="fc" id="L85">    }</span>
    /**
     * Get the flags as an int like the one used to encode SAM/BAM files.
     * @return the set bits as an int.
     */
    public int asInt(){
<span class="fc" id="L91">        return setBits;</span>
    }
    /**
     * Get the flags as an BitSet where the values present will be switched to &quot;on&quot;.
     * @return a new BitSet with the values for the present flags set.
     */
    public BitSet asBitSet(){
<span class="nc" id="L98">        return IOUtil.toBitSet(setBits);</span>
    }
    /**
     * Does this flags object contain the given flag.
     * @param flag the flag to check can not be null.
     * @return true if it contains; false otherwise.
     * 
     * @throws NullPointerException if flag is null.
     */
    public boolean contains(SamRecordFlag flag){
<span class="fc" id="L108">        return flag.matches(setBits);</span>
    }
    /**
     * Add the given flag to the current set AND RETURN A DIFFERENT OBJECT.
     * @param flag the flag to add can not be null.
     * @return A different SamRecordFlags object than this since SamRecordFlags is immutable.
     * 
     * @throws NullPointerException if flag is null.
     */
    public SamRecordFlags add(SamRecordFlag flag){
<span class="nc" id="L118">        int newValue = setBits;</span>
<span class="nc" id="L119">        newValue |= flag.getBitFlags();</span>
<span class="nc" id="L120">        return valueOf(newValue);</span>
    }
    /**
     * Add the given flags to the current set AND RETURN A DIFFERENT OBJECT.
     * @param flag the flag to add can not be null.
     * @param additionalFlags more  flags to add can not be null nor contain any null values.
     * @return A different SamRecordFlags object than this since SamRecordFlags is immutable.
     * 
     * @throws NullPointerException if any flag is null.
     */
    public SamRecordFlags add(SamRecordFlag flag, SamRecordFlag...additionalFlags){
<span class="nc" id="L131">        int newValue = setBits;</span>
<span class="nc" id="L132">        newValue |= flag.getBitFlags();</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">        for(SamRecordFlag f : additionalFlags){</span>
<span class="nc" id="L134">            newValue |= f.getBitFlags();</span>
        }
<span class="nc" id="L136">        return valueOf(newValue);</span>
    }
    /**
     * Removes the given flag to the current set AND RETURN A DIFFERENT OBJECT.
     * @param flag the flag to remove can not be null.
     * @param additionalFlags more  flags to remove can not be null nor contain any null values.
     * @return A different SamRecordFlags object than this since SamRecordFlags is immutable.
     * 
     * @throws NullPointerException any flag is null.
     */
    public SamRecordFlags remove(SamRecordFlag flag){
<span class="nc" id="L147">        int newValue = setBits;</span>
<span class="nc" id="L148">        newValue ^= flag.getBitFlags();</span>
<span class="nc" id="L149">        return valueOf(newValue);</span>
    }
    /**
     * Removes the given flag to the current set AND RETURN A DIFFERENT OBJECT.
     * @param flag the flag to remove can not be null.
     * @return A different SamRecordFlags object than this since SamRecordFlags is immutable.
     * 
     * @throws NullPointerException if flag is null.
     */
    public SamRecordFlags remove(SamRecordFlag flag, SamRecordFlag...additionalFlags){
<span class="nc" id="L159">        int newValue = setBits;</span>
<span class="nc" id="L160">        newValue ^= flag.getBitFlags();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        for(SamRecordFlag f : additionalFlags){</span>
<span class="nc" id="L162">            newValue ^= f.getBitFlags();</span>
        }
<span class="nc" id="L164">        return valueOf(newValue);</span>
    }
    @Override
    public int hashCode() {
<span class="nc" id="L168">        final int prime = 31;</span>
<span class="nc" id="L169">        int result = 1;</span>
<span class="nc" id="L170">        result = prime * result + setBits;</span>
<span class="nc" id="L171">        return result;</span>
    }
    @Override
    public boolean equals(Object obj) {
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        if (this == obj) {</span>
<span class="fc" id="L176">            return true;</span>
        }
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L179">            return false;</span>
        }
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (!(obj instanceof SamRecordFlags)) {</span>
<span class="nc" id="L182">            return false;</span>
        }
<span class="nc" id="L184">        SamRecordFlags other = (SamRecordFlags) obj;</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (setBits != other.setBits) {</span>
<span class="nc" id="L186">            return false;</span>
        }
<span class="nc" id="L188">        return true;</span>
    }
    /**
     * Get the flags as a Set of {@link SamRecordFlag} objects.
     * @return a new Set.
     */
    public Set&lt;SamRecordFlag&gt; getFlags(){
<span class="nc" id="L195">        return SamRecordFlag.parseFlags(setBits);</span>
    }
    
    @Override
    public String toString() {
<span class="nc" id="L200">        return &quot;SamRecordFlags [setBits=&quot; + setBits + &quot; flags = &quot; + getFlags() + &quot; ]&quot;;</span>
    }
    /**
     * Is this potentially a reference sequence.
     * @return true if the bits == 516 as per the SAM spec.
     */
    public boolean maybeReferenceSequence(){
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        return setBits == 516;</span>
    }
    /**
     * Is this record a dummy sequence where only the 
     * property annotations are used.
     * @return true if flags is set to 768 as per the SAM spec.
     */
    public boolean isAnnotation(){
        
<span class="nc bnc" id="L216" title="All 2 branches missed.">        return setBits == 768;</span>
    }
    
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>