<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ScfChromatogramBuilder.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jillion</a> &gt; <a href="index.source.html" class="el_package">org.jcvi.jillion.trace.chromat.scf</a> &gt; <span class="el_source">ScfChromatogramBuilder.java</span></div><h1>ScfChromatogramBuilder.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Jillion development code
 * 
 * This code may be freely distributed and modified under the
 * terms of the GNU Lesser General Public License.  This should
 * be distributed with the code.  If you do not have a copy,
 *  see:
 * 
 *          http://www.gnu.org/copyleft/lesser.html
 * 
 * 
 * Copyright for this code is held jointly by the individual authors.  These should be listed in the @author doc comments.
 * 
 * Information about Jillion can be found on its homepage
 * 
 *         http://jillion.sourceforge.net
 * 
 * Contributors:
 *     Danny Katzel - initial API and implementation
 ******************************************************************************/
/*
 * Created on Oct 2, 2008
 *
 * @author dkatzel
 */
package org.jcvi.jillion.trace.chromat.scf;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.Arrays;
import java.util.Map;

import org.jcvi.jillion.core.pos.PositionSequence;
import org.jcvi.jillion.core.pos.PositionSequenceBuilder;
import org.jcvi.jillion.core.qual.QualitySequence;
import org.jcvi.jillion.core.qual.QualitySequenceBuilder;
import org.jcvi.jillion.core.residue.nt.NucleotideSequence;
import org.jcvi.jillion.core.util.Builder;
import org.jcvi.jillion.internal.trace.chromat.BasicChromatogramBuilder;
import org.jcvi.jillion.internal.trace.chromat.scf.PrivateDataImpl;
import org.jcvi.jillion.internal.trace.chromat.scf.ScfChromatogramImpl;
import org.jcvi.jillion.trace.chromat.Chromatogram;

/**
 * {@code SCFChromatogramBuilder} uses the Builder pattern
 * to create a new {@link ScfChromatogram} instance.
 * @author dkatzel
 *
 *
 */
public final class ScfChromatogramBuilder implements Builder&lt;ScfChromatogram&gt;{

    
    private QualitySequence substitutionConfidence;
    private QualitySequence insertionConfidence;
    private QualitySequence deletionConfidence;

    private byte[] privateData;
   
    private final BasicChromatogramBuilder basicBuilder;
    /**
     * Create a new ScfChromatogramBuilder instance with
     * all fields except for the id unset.  In order
     * to successfully build a valid {@link ScfChromatogram}
     * object please use
     * the various setter methods
     * in this class to set everything
     * before calling {@link #build()}.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null.
     * @throws NullPointerException if either field is null.
     */
<span class="fc" id="L74">    public ScfChromatogramBuilder(String id){</span>
<span class="fc" id="L75">        basicBuilder = new BasicChromatogramBuilder(id);</span>
<span class="fc" id="L76">    }</span>
    /**
     * Create a new ScfChromatogramBuilder instance
     * with the given id and all fields initially set
     * to the the values encoded in the given scf file.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param scfFile a SCF encoded file that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or if
     * the given file is not a valid scf encoded file.
     * @throws NullPointerException if either field is null.
     */
    public ScfChromatogramBuilder(String id, File scfFile) throws IOException{
<span class="fc" id="L90">		this(id);</span>
<span class="fc" id="L91">		SCFChromatogramFileBuilderVisitor visitor = new SCFChromatogramFileBuilderVisitor(this);</span>
<span class="fc" id="L92">	    ScfChromatogramParser.create(scfFile).accept(visitor);       </span>
<span class="fc" id="L93">    }</span>
    /**
     * Create a new ScfChromatogramBuilder instance
     * with the given id and all fields initially set
     * to the the values encoded in the given scf encoded inputStream.
     * The {@link InputStream} will NOT be closed by this constructor,
     * client code must close the stream themselves after returning 
     * from this method (preferably in a finally block).
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param scfInputStream a SCF encoded {@link InputStream} that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or
     * if the {@link InputStream} does not contain valid scf encoded data.
     * @throws NullPointerException if either field is null.
     */
    public ScfChromatogramBuilder(String id, InputStream scfInputStream) throws IOException{
<span class="fc" id="L110">		this(id);</span>
<span class="fc" id="L111">		SCFChromatogramFileBuilderVisitor visitor = new SCFChromatogramFileBuilderVisitor(this);</span>
<span class="fc" id="L112">		ScfChromatogramParser.create(scfInputStream).accept(visitor);      </span>
<span class="fc" id="L113">    }</span>
    /**
     * Create a new instance of ScfChromatogramBuilder
     * using the given {@link Chromatogram} instance 
     * to set all the initial fields. Only the fields 
     * in the {@link Chromatogram} interface will be copied,
     * any scf specific fields will be null.  Use the various
     * scf specific setter methods to set those values.
     * @param copy a {@link Chromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
<span class="fc" id="L126">    public ScfChromatogramBuilder(Chromatogram copy){</span>
<span class="fc" id="L127">       basicBuilder = new BasicChromatogramBuilder(copy);        </span>
<span class="fc" id="L128">    }</span>
    /**
     * Create a new instance of ScfChromatogramBuilder
     * using the given {@link Chromatogram} instance 
     * to set all the initial fields. Only the fields 
     * in the {@link Chromatogram} interface will be copied,
     * any scf specific fields will be null.  Use the various
     * scf specific setter methods to set those values.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null.
     * @param copy a {@link Chromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
<span class="nc" id="L143">    public ScfChromatogramBuilder(String id, Chromatogram copy){</span>
<span class="nc" id="L144">       basicBuilder = new BasicChromatogramBuilder(id, copy);        </span>
<span class="nc" id="L145">    }</span>
    /**
     * Create a new instance of ScfChromatogramBuilder
     * using the given {@link ScfChromatogram} instance 
     * to set all the initial fields. All the fields 
     * in the {@link ScfChromatogram} interface including
     * scf specific fields will be copied.
     * @param copy a {@link ScfChromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
    public ScfChromatogramBuilder(ScfChromatogram copy){
<span class="nc" id="L158">        this((Chromatogram)copy);</span>
<span class="nc" id="L159">        this.substitutionConfidence =copy.getSubstitutionConfidence();</span>
<span class="nc" id="L160">        this.deletionConfidence =copy.getDeletionConfidence();</span>
<span class="nc" id="L161">        this.insertionConfidence =copy.getInsertionConfidence();</span>
<span class="nc" id="L162">        privateData(copy.getPrivateData().getBytes());</span>
<span class="nc" id="L163">     }</span>
    /**
     * @return the substitutionConfidence
     */
    public QualitySequence substitutionConfidence() {
<span class="fc" id="L168">        return substitutionConfidence;</span>
    }

    /**
     * @param substitutionConfidence the substitutionConfidence to set
     */
    public ScfChromatogramBuilder substitutionConfidence(byte[] substitutionConfidence) {
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        this.substitutionConfidence = substitutionConfidence ==null</span>
        		? null
<span class="fc" id="L177">        		: new QualitySequenceBuilder(substitutionConfidence).build();</span>
<span class="fc" id="L178">        return this;</span>
    }

    /**
     * @return the insertionConfidence
     */
    public QualitySequence insertionConfidence() {
<span class="fc" id="L185">        return insertionConfidence;</span>
    }

    /**
     * @param insertionConfidence the insertionConfidence to set
     */
    public ScfChromatogramBuilder insertionConfidence(byte[] insertionConfidence) {
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        this.insertionConfidence = insertionConfidence ==null</span>
        		? null
<span class="fc" id="L194">        	:  	new QualitySequenceBuilder(insertionConfidence).build();</span>
<span class="fc" id="L195">        return this;</span>
    }

    /**
     * @return the deletionConfidence
     */
    public QualitySequence deletionConfidence() {
<span class="fc" id="L202">        return deletionConfidence;</span>
    }

    /**
     * @param deletionConfidence the deletionConfidence to set
     */
    public ScfChromatogramBuilder deletionConfidence(byte[] deletionConfidence) {
<span class="pc bpc" id="L209" title="1 of 2 branches missed.">        this.deletionConfidence = deletionConfidence ==null?null</span>
<span class="fc" id="L210">        	: new QualitySequenceBuilder(deletionConfidence).build();</span>
        
<span class="fc" id="L212">        return this;</span>
    }

    /**
     * @return the privateData
     */
    public byte[] privateData() {
<span class="fc bfc" id="L219" title="All 2 branches covered.">        return privateData==null? null:Arrays.copyOf(privateData, privateData.length);</span>
    }

    /**
     * @param privateData the privateData to set
     */
    public ScfChromatogramBuilder privateData(byte[] privateData) {
<span class="fc bfc" id="L226" title="All 2 branches covered.">        this.privateData = privateData==null? null:Arrays.copyOf(privateData, privateData.length);</span>
<span class="fc" id="L227">        return this;</span>
    }

    public ScfChromatogram build() {
<span class="fc" id="L231">        Chromatogram basicChromo = basicBuilder.build();</span>
<span class="fc" id="L232">        return new ScfChromatogramImpl(basicChromo,</span>
<span class="fc" id="L233">                substitutionConfidence(),</span>
<span class="fc" id="L234">                insertionConfidence(),</span>
<span class="fc" id="L235">                deletionConfidence(),</span>
<span class="fc" id="L236">                createPrivateData());</span>
    }
   
    private PrivateData createPrivateData() {
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">        if(privateData() ==null){</span>
<span class="fc" id="L241">            return null;</span>
        }
<span class="nc" id="L243">        return new PrivateDataImpl(privateData());</span>
    }

    public final PositionSequence peaks() {
<span class="fc" id="L247">        return basicBuilder.peaks();</span>
    }

    public ScfChromatogramBuilder peaks(short[] peaks) {
<span class="fc" id="L251">        basicBuilder.peaks(new PositionSequenceBuilder(peaks).build());</span>
<span class="fc" id="L252">        return this;</span>
    }

    public final NucleotideSequence basecalls() {
<span class="fc" id="L256">        return basicBuilder.basecalls();</span>
    }

    public ScfChromatogramBuilder basecalls(NucleotideSequence basecalls) {
<span class="fc" id="L260">        basicBuilder.basecalls(basecalls);</span>
<span class="fc" id="L261">        return this;</span>
    }

    public final byte[] aQualities() {
<span class="fc" id="L265">        return basicBuilder.aQualities();</span>
    }

    public final ScfChromatogramBuilder aQualities(byte[] qualities) {
<span class="fc" id="L269">        basicBuilder.aQualities(qualities);</span>
<span class="fc" id="L270">        return this;</span>
    }

    public final byte[] cQualities() {
<span class="fc" id="L274">        return basicBuilder.cQualities();</span>
    }

    public final ScfChromatogramBuilder cQualities(byte[] qualities) {
<span class="fc" id="L278">        basicBuilder.cQualities(qualities);</span>
<span class="fc" id="L279">        return this;</span>
    }

    public final byte[] gQualities() {
<span class="fc" id="L283">        return basicBuilder.gQualities();</span>
    }

    public final ScfChromatogramBuilder gQualities(byte[] qualities) {
<span class="fc" id="L287">        basicBuilder.gQualities(qualities);</span>
<span class="fc" id="L288">        return this;</span>
    }

    public final byte[] tQualities() {
<span class="fc" id="L292">        return basicBuilder.tQualities();</span>
    }

    public final ScfChromatogramBuilder tQualities(byte[] qualities) {
<span class="fc" id="L296">        basicBuilder.tQualities(qualities);</span>
<span class="fc" id="L297">        return this;</span>
    }

    public final short[] aPositions() {
<span class="fc" id="L301">        return basicBuilder.aPositions();</span>
    }

    public final ScfChromatogramBuilder aPositions(short[] positions) {
<span class="fc" id="L305">        basicBuilder.aPositions(positions);</span>
<span class="fc" id="L306">        return this;</span>
    }

    public final short[] cPositions() {
<span class="fc" id="L310">        return basicBuilder.cPositions();</span>
    }

    public final ScfChromatogramBuilder cPositions(short[] positions) {
<span class="fc" id="L314">        basicBuilder.cPositions(positions);</span>
<span class="fc" id="L315">        return this;</span>
    }

    public final short[] gPositions() {
<span class="fc" id="L319">        return basicBuilder.gPositions();</span>
    }

    public final ScfChromatogramBuilder gPositions(short[] positions) {
<span class="fc" id="L323">        basicBuilder.gPositions(positions);</span>
<span class="fc" id="L324">        return this;</span>
    }

    public final short[] tPositions() {
<span class="fc" id="L328">        return basicBuilder.tPositions();</span>
    }

    public final ScfChromatogramBuilder tPositions(short[] positions) {
<span class="fc" id="L332">        basicBuilder.tPositions(positions);</span>
<span class="fc" id="L333">        return this;</span>
    }

    public final Map&lt;String,String&gt; comments() {
<span class="fc" id="L337">        return basicBuilder.comments();</span>
    }

    public final ScfChromatogramBuilder comments(Map&lt;String,String&gt; properties) {
<span class="fc" id="L341">        basicBuilder.comments(properties);</span>
<span class="fc" id="L342">        return this;</span>
    }

    /**
     * {@code SCFChromatogramFileBuilderVisitor} is a helper class
     * that wraps a {@link ScfChromatogramBuilder} by a {@link ScfChromatogramFileVisitor}.
     * This way when a part of the SCF is visited, its corresponding objects get built 
     * by the builder.
     * @author dkatzel
     *
     *
     */
    private static final class SCFChromatogramFileBuilderVisitor implements ScfChromatogramFileVisitor{
        private final ScfChromatogramBuilder builder;
<span class="fc" id="L356">        private SCFChromatogramFileBuilderVisitor(ScfChromatogramBuilder builder){</span>
<span class="fc" id="L357">        	this.builder = builder;</span>
<span class="fc" id="L358">        }</span>
        
        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitAConfidence(byte[] confidence) {
<span class="fc" id="L365">            builder.aQualities(confidence);            </span>
<span class="fc" id="L366">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitCConfidence(byte[] confidence) {
<span class="fc" id="L373">            builder.cQualities(confidence);            </span>
<span class="fc" id="L374">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitGConfidence(byte[] confidence) {
<span class="fc" id="L381">            builder.gQualities(confidence);            </span>
<span class="fc" id="L382">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitTConfidence(byte[] confidence) {
<span class="fc" id="L389">            builder.tQualities(confidence);            </span>
<span class="fc" id="L390">        }</span>
        
         /**
         * {@inheritDoc}
         */
         @Override
         public synchronized void visitEnd() { 
       	  	//no-op
<span class="fc" id="L398">         }</span>


          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitBasecalls(NucleotideSequence basecalls) {  
<span class="fc" id="L406">              builder.basecalls(basecalls);              </span>
<span class="fc" id="L407">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitPeaks(short[] peaks) {  
<span class="fc" id="L414">              builder.peaks(peaks);              </span>
<span class="fc" id="L415">          }</span>

         

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitComments(Map&lt;String,String&gt; comments) {  
<span class="fc" id="L424">              builder.comments(comments);              </span>
<span class="fc" id="L425">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitAPositions(short[] positions) {  
<span class="fc" id="L432">              builder.aPositions(positions);              </span>
<span class="fc" id="L433">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitCPositions(short[] positions) {  
<span class="fc" id="L440">             builder.cPositions(positions);              </span>
<span class="fc" id="L441">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitGPositions(short[] positions) {  
<span class="fc" id="L448">              builder.gPositions(positions);              </span>
<span class="fc" id="L449">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitTPositions(short[] positions) {  
<span class="fc" id="L456">              builder.tPositions(positions);              </span>
<span class="fc" id="L457">          }</span>

      
       

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitPrivateData(byte[] privateData) {
<span class="nc" id="L467">            builder.privateData(privateData);             </span>
<span class="nc" id="L468">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitSubstitutionConfidence(byte[] confidence) {
<span class="fc" id="L475">            builder.substitutionConfidence(confidence);             </span>
<span class="fc" id="L476">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitInsertionConfidence(byte[] confidence) {
<span class="fc" id="L483">            builder.insertionConfidence(confidence);</span>
<span class="fc" id="L484">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitDeletionConfidence(byte[] confidence) {
<span class="fc" id="L491">            builder.deletionConfidence(confidence);</span>
<span class="fc" id="L492">        }</span>

        
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>